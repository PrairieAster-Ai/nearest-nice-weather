<!DOCTYPE html>
<html>
<head>
    <title>Map Zoom Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; background: #f0f0f0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>Map Zoom Algorithm Test</h1>
    <div id="results"></div>
    
    <script>
        // Test the zoom calculation logic from App.tsx
        function calculateZoom(markersToShow) {
            const lats = markersToShow.map(m => m.lat);
            const lngs = markersToShow.map(m => m.lng);
            
            const minLat = Math.min(...lats);
            const maxLat = Math.max(...lats);
            const minLng = Math.min(...lngs);
            const maxLng = Math.max(...lngs);
            
            const latRange = maxLat - minLat;
            const lngRange = maxLng - minLng;
            const maxRange = Math.max(latRange, lngRange);
            
            // Use tighter padding for better initial zoom
            const paddedRange = Math.max(maxRange * 1.5, 0.01);
            
            // Use same granular zoom levels as calculateDynamicMapView
            let zoom = 18;
            if (paddedRange > 0.008) zoom = 17.5;
            if (paddedRange > 0.012) zoom = 17;
            if (paddedRange > 0.018) zoom = 16.5;
            if (paddedRange > 0.025) zoom = 16;
            if (paddedRange > 0.035) zoom = 15.5;
            if (paddedRange > 0.050) zoom = 15;
            if (paddedRange > 0.070) zoom = 14.5;
            if (paddedRange > 0.095) zoom = 14;
            if (paddedRange > 0.125) zoom = 13.5;
            if (paddedRange > 0.165) zoom = 13;
            if (paddedRange > 0.220) zoom = 12.5;
            if (paddedRange > 0.290) zoom = 12;
            if (paddedRange > 0.380) zoom = 11.5;
            if (paddedRange > 0.500) zoom = 11;
            if (paddedRange > 0.650) zoom = 10.5;
            if (paddedRange > 0.850) zoom = 10;
            if (paddedRange > 1.100) zoom = 9.5;
            if (paddedRange > 1.450) zoom = 9;
            if (paddedRange > 1.900) zoom = 8.5;
            if (paddedRange > 2.500) zoom = 8;
            
            return { zoom, paddedRange, maxRange, centerLat: (minLat + maxLat) / 2, centerLng: (minLng + maxLng) / 2 };
        }
        
        // Test scenarios
        const tests = [
            {
                name: "Single marker (should zoom very close)",
                markers: [{ lat: 46.358, lng: -94.2008 }]
            },
            {
                name: "Two close markers (Brainerd + Baxter)",
                markers: [
                    { lat: 46.358, lng: -94.2008 },
                    { lat: 46.3527, lng: -94.2424 }
                ]
            },
            {
                name: "Three nearby markers (Brainerd area)",
                markers: [
                    { lat: 46.358, lng: -94.2008 },
                    { lat: 46.3527, lng: -94.2424 },
                    { lat: 46.3441, lng: -94.1927 }
                ]
            },
            {
                name: "Wide spread (Duluth to Minneapolis)",
                markers: [
                    { lat: 46.7867, lng: -92.1005 },
                    { lat: 44.9778, lng: -93.2650 }
                ]
            }
        ];
        
        const resultsDiv = document.getElementById('results');
        
        tests.forEach(test => {
            const result = calculateZoom(test.markers);
            const resultHtml = `
                <div class="test-result ${result.zoom > 15 ? 'success' : 'info'}">
                    <h3>${test.name}</h3>
                    <p><strong>Zoom Level:</strong> ${result.zoom} (${result.zoom > 15 ? 'Good - Close zoom' : 'Moderate zoom'})</p>
                    <p><strong>Geographic Range:</strong> ${result.maxRange.toFixed(4)} degrees</p>
                    <p><strong>Padded Range:</strong> ${result.paddedRange.toFixed(4)} degrees</p>
                    <p><strong>Center:</strong> ${result.centerLat.toFixed(3)}, ${result.centerLng.toFixed(3)}</p>
                    <p><strong>Markers:</strong> ${test.markers.length}</p>
                </div>
            `;
            resultsDiv.innerHTML += resultHtml;
        });
        
        // Overall assessment
        const assessmentHtml = `
            <div class="test-result info">
                <h3>âœ… Zoom Algorithm Assessment</h3>
                <p><strong>Improvement:</strong> The new algorithm focuses on 3 closest markers instead of 5, uses tighter padding (1.5x vs larger multipliers), and implements granular zoom levels for precise control.</p>
                <p><strong>Expected Behavior:</strong> Map should now show weather markers at a comfortable viewing distance instead of showing huge geographic areas.</p>
                <p><strong>Key Changes:</strong> Reduced target markers from 5 to 3, implemented granular zoom increments (17.5, 16.5, etc.), and added minimum range handling for single markers.</p>
            </div>
        `;
        resultsDiv.innerHTML += assessmentHtml;
    </script>
</body>
</html>